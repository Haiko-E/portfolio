---
import { getFirstProject, formatDate, urlForImage } from '../sanity/api.js';
import '@splidejs/splide/css';

interface Project {
  _createdAt: string;
  _id: string;
  _rev: string;
  _type: string;
  _updatedAt: string;
  backgroundimage: { alttext: string; asset: Asset };
  date: string;
  description: string;
  slug: { _type: string; current: string };
  tags: string[];
  title: string;
}

interface Asset {
  _createdAt: string;
  _id: string;
  _rev: string;
  _type: string;
  _updatedAt: string;
  assetId: string;
  extension: string;
  metadata: object;
  mimeType: string;
  originalFilename: string;
  path: string;
  sha1hash: string;
  size: number;
  source: { id: string; name: string };
  uploadId: string;
  url: string;
}

const data = await getFirstProject();
---

<section id='image-carousel' class='splide' aria-label='Beautiful Images'>
  <div class='splide__track'>
    <ul class='splide__list'>
      {
        data.map((project: Project) => {
          return (
            <li class='splide__slide'>
              <div class='project'>
                <div class='project-date'>{formatDate(project.date)}</div>
                <h4>{project.title}</h4>
                <p>{project.description}</p>
                <ul class='project__tags'>
                  {project.tags.map((tag) => (
                    <li>{tag}</li>
                  ))}
                </ul>
              </div>
              <img
                src={urlForImage(project.backgroundimage.asset.url)
                  .auto('format')
                  .url()}
                alt={project.backgroundimage.alttext}
              />
            </li>
          );
        })
      }

      <li class='splide__slide'>
        <img
          src='https://images.unsplash.com/photo-1663615280810-81f2f47f3b23?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=764&q=80'
          alt=''
        />
      </li>
      <li class='splide__slide'>
        <img
          src='https://images.unsplash.com/photo-1663666964492-0b8b83a6dd18?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=686&q=80'
          alt=''
        />
      </li>
      <li class='splide__slide'>
        <div class='project'>
          <div class='project-date'>June 2022</div>
          <h4>Yelpcamp</h4>
          <p>description of my project</p>
          <ul class='project__tags'>
            <li>#Sanity</li>
            <li>#Sanity</li>
            <li>#Mininmal Javascript</li>
          </ul>
        </div>
        <img
          src='https://images.unsplash.com/photo-1663659515592-bd9f8a87fdb5?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=687&q=80'
          alt=''
        />
      </li>
    </ul>
  </div>
  <ul class='splide__pagination'></ul>
</section>

<style lang='scss'>
  @import '../sass/variables.scss';
  @import '../sass/styles.scss';

  .splide__slide {
    &::after {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-image: linear-gradient(
        to top,
        hsla(0, 0%, 0%),
        hsla(0, 0%, 10%, 0.6),
        hsla(0, 0%, 40%, 0.4),
        hsla(0, 0%, 70%, 0.3),
        hsla(0, 0%, 100%, 0.1)
      );
    }
  }

  .splide__slide img {
    display: inline-block;
    position: relative;
    object-fit: cover;
    object-position: center;
    width: 100%;
    height: 100vh;
    transition: all 300ms ease-in-out;
  }

  .splide__pagination {
    bottom: 5.5em;

    @media only screen and (max-width: $media-medium) {
      bottom: 2.5em;
    }
  }

  .project {
    padding: 10px 0;
    overflow: hidden;
    width: 80vw;
    z-index: 2;
    color: $platinum;
    position: absolute;
    bottom: 20%;
    left: 10%;
    right: -10%;
    border-bottom: 1px solid $platinum;
    cursor: pointer;

    &:hover ~ img {
      transform: scale(110%);
    }

    &:hover {
      p {
        height: fit-content;
        opacity: 1;
        margin: 0;
        margin-bottom: 3rem;
      }
    }

    &-date {
      @media (max-width: $media-medium) {
        text-align: center;
      }
    }

    h4 {
      margin-top: 0.2em;
      margin-bottom: 1em;
      font-size: 4rem;

      @media (max-width: $media-medium) {
        text-align: center;
      }
    }
    p {
      transition: all ease-in-out 300ms;
      opacity: 0;
      height: 0;
      margin-bottom: 0rem;
    }

    ul {
      padding: 0;
      display: flex;
      list-style: none;

      @media (max-width: $media-medium) {
        justify-content: center;
      }
    }

    li {
      padding-right: 1em;
    }
  }
</style>

<script>
  import '../ts/projects';
</script>
